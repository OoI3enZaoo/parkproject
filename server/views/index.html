
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!--[if IE]>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <![endif]-->
    <title>อุทยานแห่งชาติ</title>

    <link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <link href="bower_components/css/style.css" rel="stylesheet" />
    <link href="bower_components/album/album.css" rel="stylesheet">
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Mitr" rel="stylesheet">

</head>

<style media="screen">
body {
    font-family: 'Mitr', sans-serif;
}
</style>
<body>
    <header>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h4>อุทยานแห่งประเทศไทย</h4>

                </div>

            </div>
        </div>
    </header>

    <section class="menu-section">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="navbar-collapse collapse ">
                        <ul id="menu-top" class="nav navbar-nav navbar-right">
                            <li><a class="menu-top-active" href="home">หน้าหลัก</a></li>
                            <li><a href="map">แผนที่</a></li>
                            <li><a href="contact">ติดต่อเรา</a></li>
                              <li><a id="loginstatus" onclick="loginButton()">ลงชื่อเข้าใช้</a></li>

                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </section>
    <!-- MENU SECTION END-->
    <div class="content-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h4 class="page-head-line">หน้าหลัก</h4>

                </div>


            </div>

            <div class="row">
               <div class="col-md-12">
                   <div class="alert alert-success">
                       อุทยานแห่งชาติในประเทศไทย.
                   </div>
               </div>

           </div>

            <div class = "row">
                <div class ="col-md-12">
                  <div id="album"></div>

                </div>
            </div>




        </div>
    </div>



    <div class="modal fade" id="modalLogin" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content" style="width: 800px; height: 550px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title text-primary">ลงชื่อเข้าใช้สำหรับแอดมิน</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="well">
                                <form>
                                    <div class="form-group">
                                        <label for="username" class="control-label">Username</label>
                                        <input type="text" class="form-control" id="username" name="username" value="" required="" title="Please enter you username" placeholder="example@gmail.com">
                                        <span class="help-block"></span>
                                    </div>
                                    <div class="form-group">
                                        <label for="password" class="control-label">Password</label>
                                        <input type="password" class="form-control" id="password" name="password" value="" required="" title="Please enter your password">
                                        <span class="help-block"></span>
                                    </div>
                                    <div id="loginErrorMsg" class="alert alert-error hide">Wrong username og password</div>
                                    <div class="checkbox">

                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <h5  class = "text-center" style="color: #ff0000;"><b id = "txtError"></b></h5>
                    <button onclick="checkLogin()" class="btn btn-success btn-block">Login</button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="modalLogout" role="dialog">
        <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><h4>ลงชื่อออก <i class="fa fa-lock"></i></h4></div>
          <div class="modal-body"><i class="fa fa-question-circle"></i>คุณต้องการจะลงชื่อออกใช่หรือไม่</div>
          <div class="modal-footer"><a onclick ="logout()" class="btn btn-primary btn-block">ออกจากระบบ</a></div>
        </div>
      </div>
    </div>


    <!-- CONTENT-WRAPPER SECTION END-->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    &copy; 2015 YourCompany | By : <a href="http://www.designbootstrap.com/" target="_blank">DesignBootstrap</a>
                </div>

            </div>
        </div>
    </footer>
    <script>
        $(function() {

          checkStatus();
            $.getJSON("http://localhost:1337/api/pic_info", function(result) {
                if (result.length != 0) {
                    for (i = 0; i < result.length; i++) {
                      var opencard = "<div class='card'> ";
                      var img = "<img src='"+result[i].url+"'  class='img-responsive' alt='Card image cap' width='600' height='400'> ";
                      setTitle(result[i].id,opencard,img);
                    }
                }
            });
            function setTitle(id,opencard,img){
              $.getJSON("http://localhost:1337/api/namefromid="+id,function(result){
                var parkname = "<h4>"+result[0].park_name+"<h4>"
                var output = opencard + parkname + img;
                setDetail(id,output);
              });
            }
            function setDetail(id,output){
              $.getJSON("http://localhost:1337/api/detailfromid="+id, function(result2) {
                var cardtext = "<blockquote><p class='card-text'>"+result2[0].detail+" <a href='#'>เพิ่มเติม...</a></p></blockquote> ";
                var closecard = "</div>";
                output = output+ cardtext + closecard;
                $("#album").append(output);
              });

            }
        });
                function loginButton() {
                  if(window.localStorage.getItem("status") != "admin"){
                      $("#modalLogin").modal();
                  }else{
                      $("#modalLogout").modal();
                  }

                }
                function logout(){
                  window.localStorage.setItem('status', null);
                  window.localStorage.setItem('username', null);
                  window.localStorage.setItem('email', null);
                  $('#modalLogout').modal('toggle');
                  checkStatus();
                  getNotification("pe-7s-smile", "ลงชื่อออกสำเร็จ", "<b>Success</b>");

                }

                function checkLogin() {
                    console.log("checkLogin");
                      var username = $("#username").val();
                      var password = $("#password").val();
                      $.getJSON("http://localhost:1337/api/checkLogin/" + username + "/" + password + "", function(result) {
                        if (result.length > 0) {
                          window.localStorage.setItem('status', "admin");
                          window.localStorage.setItem('username', result[0].username);
                          window.localStorage.setItem('email', result[0].email);
                          console.log("email: " + window.localStorage.getItem('email'));
                          $('#modalLogin').modal('toggle');
                          checkStatus();
                          getNotification("pe-7s-smile", "ลงชื่อเข้าใช้สำเร็จ", "<b>Success</b>");
                        }else{
                          console.log("bene");
                          $("#txtError").text("ไอดีหรือรหัสผ่านผิดพลาด");
                        }
                      });
                }

                function checkStatus() {
                    if (window.localStorage.getItem('status') == "admin") {
                        $("#loginstatus").text("ลงชื่อออก");
                    } else {
                        $("#loginstatus").text("ลงชื่อเข้าใช้");
                    }
                }

                function getNotification(micon, mtype, mdata) {

               $.notify({
                   icon: micon, //icon
                   message: mdata //data

               }, {
                   type: mtype, //type  danger ,warning ,success ,info
                   timer: 2000
               });


           }

    </script>


</body>

</html>
